(function(c,r){typeof exports=="object"&&typeof module<"u"?r(exports):typeof define=="function"&&define.amd?define(["exports"],r):(c=typeof globalThis<"u"?globalThis:c||self,r(c.ChaosMaker={}))})(this,function(c){"use strict";var O=Object.defineProperty;var M=(c,r,l)=>r in c?O(c,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):c[r]=l;var h=(c,r,l)=>M(c,typeof r!="symbol"?r+"":r,l);function r(e){return Math.random()<e}function l(e,t){return async(s,o)=>{var p;const i=s.toString(),n=((p=o==null?void 0:o.method)==null?void 0:p.toUpperCase())||"GET";if(t.failures){for(const a of t.failures)if(i.includes(a.urlPattern)&&r(a.probability)&&(!a.methods||a.methods.includes(n)))return console.warn(`CHAOS: Forcing ${a.statusCode} for ${n} ${i}`),new Response(JSON.stringify({error:"Chaos Maker Attack!"}),{status:a.statusCode,statusText:"Service Unavailable (Chaos)"})}if(t.latencies)for(const a of t.latencies)i.includes(a.urlPattern)&&r(a.probability)&&(!a.methods||a.methods.includes(n))&&(console.warn(`CHAOS: Adding ${a.delayMs}ms latency to ${n} ${i}`),await new Promise(b=>setTimeout(b,a.delayMs)));return e(s,o)}}function f(e){return Math.random()<e}function w(e,t){return function(s){const o=this._chaos_url,i=this._chaos_method;if(t.failures){for(const n of t.failures)if(o.includes(n.urlPattern)&&f(n.probability)&&(!n.methods||n.methods.includes(i))){console.warn(`CHAOS: Forcing ${n.statusCode} for ${i} ${o}`),Object.defineProperty(this,"status",{value:n.statusCode}),Object.defineProperty(this,"statusText",{value:"Service Unavailable (Chaos)"}),this.dispatchEvent(new Event("error")),this.dispatchEvent(new Event("load")),this.dispatchEvent(new Event("loadend"));return}}if(t.latencies){for(const n of t.latencies)if(o.includes(n.urlPattern)&&f(n.probability)&&(!n.methods||n.methods.includes(i))){console.warn(`CHAOS: Adding ${n.delayMs}ms latency to ${i} ${o}`),setTimeout(()=>{e.call(this,s)},n.delayMs);return}}e.call(this,s)}}function y(e){return function(t,s){this._chaos_url=s.toString(),this._chaos_method=t.toUpperCase(),e.call(this,t,s)}}function m(e){return Math.random()<e}function d(e,t){if(m(t.probability)){console.warn(`CHAOS: Applying action '${t.action}' to element:`,e);try{switch(t.action){case"disable":"disabled"in e&&(e.disabled=!0);break;case"hide":e.style.display="none";break;case"remove":e.remove();break}}catch(s){console.error("Chaos Maker failed to assault element:",s,e)}}}function g(e,t){if(e.nodeType!==Node.ELEMENT_NODE||!t.assaults)return;const s=e;for(const o of t.assaults){try{s.matches(o.selector)&&d(s,o)}catch(i){console.error(`Chaos Maker: Invalid selector '${o.selector}'`,i)}s.querySelectorAll(o.selector).forEach(i=>{d(i,o)})}}function C(e){if(e.assaults){console.log("CHAOS: Running initial DOM scan for existing elements...");for(const s of e.assaults)try{document.querySelectorAll(s.selector).forEach(o=>{d(o,s)})}catch(o){console.error(`Chaos Maker: Invalid selector in initial scan '${s.selector}'`,o)}}return new MutationObserver(s=>{for(const o of s)o.type==="childList"&&o.addedNodes.forEach(i=>g(i,e))})}class u{constructor(t){h(this,"config");h(this,"originalFetch");h(this,"originalXhrSend");h(this,"originalXhrOpen");h(this,"domObserver");this.config=t,console.log("Chaos Maker initialized with config:",t)}start(){console.log("üõ†Ô∏è Chaos Maker ENGAGED üõ†Ô∏è"),this.config.network&&(this.originalFetch=window.fetch,window.fetch=l(this.originalFetch.bind(window),this.config.network),this.originalXhrOpen=window.XMLHttpRequest.prototype.open,window.XMLHttpRequest.prototype.open=y(this.originalXhrOpen),this.originalXhrSend=window.XMLHttpRequest.prototype.send,window.XMLHttpRequest.prototype.send=w(this.originalXhrSend,this.config.network)),this.config.ui&&(this.domObserver=C(this.config.ui),this.domObserver.observe(document.body,{childList:!0,subtree:!0}),console.log("UI Assailant is now observing the DOM."))}stop(){console.log("üõë Chaos Maker DISENGAGED üõë"),this.originalFetch&&(window.fetch=this.originalFetch),this.originalXhrSend&&(window.XMLHttpRequest.prototype.send=this.originalXhrSend),this.originalXhrOpen&&(window.XMLHttpRequest.prototype.open=this.originalXhrOpen),this.domObserver&&(this.domObserver.disconnect(),console.log("UI Assailant has stopped observing."))}}if(typeof window<"u"){window.ChaosMaker=u;const e={instance:null,start:t=>{try{return e.instance&&e.instance.stop(),e.instance=new u(t),e.instance.start(),{success:!0,message:"Chaos started"}}catch(s){return console.error("Chaos Utils Error:",s),{success:!1,message:s.message}}},stop:()=>e.instance?(e.instance.stop(),e.instance=null,{success:!0,message:"Chaos stopped"}):{success:!1,message:"No chaos instance to stop"}};if(window.chaosUtils=e,window.__CHAOS_CONFIG__)try{const t=window.__CHAOS_CONFIG__;e.start(t),delete window.__CHAOS_CONFIG__}catch(t){console.error("ChaosMaker auto-start failed:",t)}}c.ChaosMaker=u,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
